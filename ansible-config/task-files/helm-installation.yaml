# Helm installation
- name: Check if Helm is installed
  command: which helm
  changed_when: false
  failed_when: helm_installed.rc not in [0, 1]
  register: helm_installed

- name: Download Helm installer
  copy:
    src: helm/get-helm.sh
    dest: /tmp/get-helm.sh
  when:
    helm_installed.rc != 0

- name: Install tar
  dnf:
    pkg:
      - tar
    state: installed

- name: Install Helm
  command: sh /tmp/get-helm.sh
  environment:
    HELM_INSTALL_DIR: /usr/bin
  when:
    helm_installed.rc != 0

- name: Fetch Helm releases
  command: helm ls
  register: release_list
  environment:
    KUBECONFIG: "/etc/rancher/rke2/rke2.yaml"

- name: View Helm releases
  debug:
    msg: "{{ release_list.stdout }}"
  run_once: true


